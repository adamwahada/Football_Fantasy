<!-- user-gameweek-participation-modal.component.html - Cleaned version with buy-in preserved -->
<div class="modal-overlay" *ngIf="isVisible" (click)="onOverlayClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Rejoindre une Compétition</h2>
      <button class="close-btn" (click)="closeModal()" [disabled]="isLoading || errorDisplay.show">&times;</button>
    </div>

    <!-- Error Display Section -->
    <div *ngIf="errorDisplay.show" [ngClass]="'error-display-container ' + errorDisplay.type" class="error-container">
      <div class="error-header">
        <span class="error-icon">{{ getErrorIcon() }}</span>
        <strong class="error-title">{{ errorDisplay.message }}</strong>
      </div>

      <!-- Suggestions Section -->
      <div *ngIf="errorDisplay.suggestions && errorDisplay.suggestions.length > 0" class="suggestions-section">
        <h4>Suggestions:</h4>
        <ul class="suggestions-list">
          <li *ngFor="let suggestion of errorDisplay.suggestions" class="suggestion-item">
            {{ suggestion }}
          </li>
        </ul>
      </div>

      <!-- Retry/Close Button for Error Actions -->
      <div class="error-actions">
        <button *ngIf="errorDisplay.canRetry" 
                type="button" 
                class="btn-retry" 
                (click)="clearError()"
                [disabled]="isLoading">
          Modifier et réessayer
        </button>
        <button *ngIf="!errorDisplay.canRetry" 
                type="button" 
                class="btn-close-error" 
                (click)="closeModal()"
                [disabled]="isLoading">
          Fermer
        </button>
      </div>
    </div>

    <!-- Main Form -->
    <form [formGroup]="participationForm" (ngSubmit)="onSubmit()" 
          *ngIf="!errorDisplay.show || errorDisplay.canRetry">
      
      <div class="form-group">
        <label for="sessionType">Type de Session:</label>
        <select id="sessionType" formControlName="sessionType" class="form-control" [disabled]="isLoading">
          <option value="">Sélectionner un type</option>
          <option value="ONE_VS_ONE">1 vs 1</option>
          <option value="SMALL_GROUP">Best of 5</option>
          <option value="MEDIUM_GROUP">Best of 10</option>
          <option value="OPEN_ROOM">Open Room</option>
        </select>
        <div class="error-message" *ngIf="participationForm.get('sessionType')?.invalid && participationForm.get('sessionType')?.touched">
          Veuillez sélectionner un type de session
        </div>
      </div>

      <!-- Buy-in Amount Selection -->
      <div class="buy-in-section">
        <label class="section-label">Montant de mise</label>
        <div class="buy-in-options">
          <button 
            *ngFor="let amount of buyInOptions" 
            type="button"
            [ngClass]="{'active': selectedBuyIn === amount}"
            [disabled]="isLoading || !isAmountAffordable(amount)"
            (click)="onBuyInClick(amount)"
            [attr.title]="!isAmountAffordable(amount) ? 'Solde insuffisant pour ce montant' : ''">
            <span class="amount">{{ amount.toFixed(2) }}€</span>
            <span *ngIf="selectedBuyIn === amount" class="selected-indicator">✓</span>
          </button>
        </div>

        <!-- Selected Amount Display -->
        <div class="selected-amount-display" *ngIf="selectedBuyIn > 0">
          Montant sélectionné: <strong>{{ selectedBuyIn.toFixed(2) }}€</strong>
          <span *ngIf="!isAmountAffordable(selectedBuyIn)" class="unaffordable-indicator">⚠️ Solde insuffisant</span>
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-container">
          <input type="checkbox" formControlName="isPrivate" [disabled]="isLoading">
          <span class="checkmark"></span>
          Session privée
        </label>
      </div>

      <div class="form-group" *ngIf="participationForm.get('isPrivate')?.value">
        <label for="accessKey">Clé d'accès:</label>
        <input type="text"
               id="accessKey"
               formControlName="accessKey"
               class="form-control"
               [disabled]="isLoading"
               placeholder="Entrez la clé d'accès">
        <div class="error-message" *ngIf="participationForm.get('accessKey')?.invalid && participationForm.get('accessKey')?.touched">
          La clé d'accès est requise pour les sessions privées
        </div>
      </div>
      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" 
                class="btn btn-secondary" 
                (click)="closeModal()" 
                [disabled]="isLoading || errorDisplay.show">
          Annuler
        </button>
        <button type="submit"
                class="btn btn-primary"
                [disabled]="participationForm.invalid || isLoading || selectedBuyIn <= 0 || !isAmountAffordable(selectedBuyIn) || !hasAnyAffordableAmount()">
          <span *ngIf="isLoading" class="spinner"></span>
          {{ isLoading ? 'Traitement...' : 'Confirmer et Rejoindre' }}
        </button>
      </div>
    </form>

    <!-- Alternative: Show only error message for non-retryable errors -->
    <div *ngIf="errorDisplay.show && !errorDisplay.canRetry && errorDisplay.type !== 'success'" 
         class="error-only-content">
      <div class="error-only-message">
        <p>{{ errorDisplay.message }}</p>
        <div *ngIf="errorDisplay.suggestions && errorDisplay.suggestions.length > 0">
          <h4>Que faire:</h4>
          <ul>
            <li *ngFor="let suggestion of errorDisplay.suggestions">{{ suggestion }}</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div *ngIf="isLoading" class="loading-overlay">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <p>Traitement en cours...</p>
      </div>
    </div>
  </div>
</div>
