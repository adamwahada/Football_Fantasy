<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal" (click)="onModalContentClick($event)">

    <!-- Close Button -->
    <button class="close-icon" aria-label="Close modal" (click)="closeModal()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
           stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>


<!-- Modal Header -->
<div class="modal-header border-b pb-3">
  <!-- Back Button - positioned at top left -->
  <div class="back-button">
    <button
      mat-stroked-button
      color="primary"
      class="flex items-center gap-2 px-4 py-2 rounded-lg shadow hover:scale-105 transition-transform"
      (click)="goBack()"
      matTooltip="Go back"
      aria-label="Go back"
    >
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
  </div>

  <!-- League icon and name - centered and aligned -->
  <div class="header-content">
    <img
      *ngIf="getLeagueIconUrl(competition)"
      [src]="getLeagueIconUrl(competition)"
      
      [alt]="formatCompetitionName(competition) + ' logo'"
      class="league-logo"
      (error)="handleImageError($event)"
    />
    <h2 class="league-title">
      {{ formatCompetitionName(competition) }}
    </h2>
  </div>

  <!-- Table Button - below and to the left -->
  <div class="flex justify-start">
    <button
    mat-raised-button
    color="primary"
    class="button-spacing text-white font-semibold px-4 py-2 rounded-lg shadow-lg hover:scale-105 transition-transform"
    (click)="openLeagueTable(competition)"
    matTooltip="View League Table"
    aria-label="View League Table"
  >
    <mat-icon class="mr-2">table_chart</mat-icon>
    Table
  </button>
  
  </div>
</div>


    <!-- Error State -->
    <div *ngIf="error" class="error">
      {{ error }}
      <button class="retry-button" (click)="retryLoading()">Try Again</button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading">Loading gameweeks...</div>

      <div class="gameweek-cards" *ngIf="!loading && !error">
        <button
          *ngFor="let gw of gameweeks; let i = index"
          class="gameweek-card"
          [class.featured]="isCurrentGameweek(gw.weekNumber)"
          [class.next-upcoming]="isNextUpcomingGameweek(gw)"
          [class.ongoing]="getGameweekStatus(gw) === 'ONGOING'"
          [class.finished]="getGameweekStatus(gw) === 'FINISHED'"
          [class.upcoming]="getGameweekStatus(gw) === 'UPCOMING' && !isNextUpcomingGameweek(gw)"
          [disabled]="isLockedGameweek(gw.weekNumber) || (getGameweekStatus(gw) === 'UPCOMING' && !gw.validated)"
          (click)="(!isLockedGameweek(gw.weekNumber) && (getGameweekStatus(gw) !== 'UPCOMING' || gw.validated)) && (getGameweekStatus(gw) === 'FINISHED' ? openFinishedGameweek(gw) : openGameweekMatches(gw.weekNumber))"
          [matTooltip]="(getGameweekStatus(gw) === 'UPCOMING' && !gw.validated) ? 'Not available yet' : (isLockedGameweek(gw.weekNumber) ? 'Locked' : 'Open')"
          [attr.aria-label]="'Open matches for gameweek ' + gw.weekNumber + ((getGameweekStatus(gw) === 'UPCOMING' && !gw.validated) ? ', not available' : (isLockedGameweek(gw.weekNumber) ? ', locked' : ''))"
          (mouseenter)="showDeadlineMessage(gw)"
          (mouseleave)="hideDeadlineMessage()"
          (focus)="showDeadlineMessage(gw)"
          (blur)="hideDeadlineMessage()"
        >
          <!-- Status Icon -->
          <div class="status-icon">
            <span *ngIf="isLockedGameweek(gw.weekNumber)" class="lock-icon" title="Locked 🔒">🔒</span>
            <span *ngIf="!isLockedGameweek(gw.weekNumber) && isNextUpcomingGameweek(gw)" class="fire-icon">🔥</span>
            <span *ngIf="!isLockedGameweek(gw.weekNumber) && getGameweekStatus(gw) === 'ONGOING'" class="play-icon">▶️</span>
            <span *ngIf="!isLockedGameweek(gw.weekNumber) && getGameweekStatus(gw) === 'FINISHED'" class="check-icon">✅</span>
            <span *ngIf="!isLockedGameweek(gw.weekNumber) && getGameweekStatus(gw) === 'UPCOMING' && !isNextUpcomingGameweek(gw)" class="calendar-icon">📅</span>
          </div>

          <!-- Gameweek Number -->
          <div class="gw-number">GW{{ gw.weekNumber }}</div>

          <!-- Status Text -->
          <div class="status-text">
            {{ (getGameweekStatus(gw) === 'UPCOMING' && !gw.validated) ? 'Not available' : (isLockedGameweek(gw.weekNumber) ? 'Locked' : getGameweekDisplayStatus(gw)) }}
          </div>

          <!-- Deadline Tooltip inside the button -->
          <div
            class="deadline-tooltip"
            *ngIf="isNextTwoUpcomingGameweek(gw) && hoveredGameweekNumber === gw.weekNumber"
          >
            {{ getDeadlineMessage(gw) }}
          </div>
        </button>
      </div>
    </div>
  </div>
</div>
