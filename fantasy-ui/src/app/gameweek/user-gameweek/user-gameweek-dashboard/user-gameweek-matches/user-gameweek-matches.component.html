<div class="gameweek-list-container">
  <div class="content-wrapper">
    <div class="min-h-screen bg-gradient-to-b from-green-900/95 via-gray-900 to-black p-7 pt-20 text-green-50">
      <div class="max-w-6xl mx-auto">
        
        <header class="flex justify-between items-center mb-5 pt-6">
          <!-- Left side: icon + league name + gameweek inline -->
          <div class="flex items-center gap-3 flex-1">
            <img *ngIf="leagueIconUrl" [src]="leagueIconUrl" [alt]="leagueDisplayName" class="h-8 w-8 object-contain" />
            <h1 class="league-title">
              {{ leagueDisplayName }} - {{ selectedWeekNumber }}
            </h1>
          </div>
        </header>

        <!-- Subtitle and deadline below -->
        <div class="text-center mt-1 mb-0">
          <p *ngIf="deadlineCountdown" class="text-xs text-yellow-300 mt-1 mb-0">
            Deadline: <span>{{ deadlineCountdown }}</span>
          </p>
          <p class="text-sm text-white/30">
            Click on teams to predict winners or draw. Tiebreak matches require exact score predictions.
          </p>
        </div>

        <!-- ðŸ”´ Modern Error Popup -->
        <div *ngIf="errorMessage" class="error-popup-overlay" 
             [class.closing]="isClosingPopup"
             (click)="closeErrorPopup()">
          <div class="error-popup" 
               [class.closing]="isClosingPopup"
               (click)="$event.stopPropagation()">
            <div class="error-popup-header">
              <div class="error-popup-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <button class="error-popup-close" (click)="closeErrorPopup()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="error-popup-content">
              <h3 class="error-popup-title">Erreur de validation</h3>
              <p class="error-popup-message">{{ errorMessage }}</p>
            </div>
            <div class="error-popup-footer">
              <button class="error-popup-btn error-popup-btn-primary" (click)="closeErrorPopup()">
                Compris
              </button>
            </div>
          </div>
        </div>

        <!-- Matches Grid -->
        <main>
          <section>
            <article *ngFor="let match of matches"
                     class="match-card"
                     [class.tiebreaker]="match.isTiebreak"
                     [id]="'match-' + match.id"
                     [class.error]="match.id === highlightedErrorId">

              <!-- Tiebreak badge -->
              <div *ngIf="match.isTiebreak" class="tiebreak-badge">
                Tie-break
              </div>

              <!-- Main match content with three columns -->
              <div class="match-content">
                <!-- Home Team -->
                <div class="team home" 
                     [class.selected]="match.pick === 'HOME_WIN'"
                     (click)="selectPick(match, 'HOME_WIN')">
                  <img *ngIf="match.homeIconUrl" 
                       [src]="match.homeIconUrl" 
                       [alt]="match.homeTeam" 
                       class="team-icon" />
                  <span class="team-name">{{ match.homeTeam }}</span>
                </div>

                <!-- Draw Button -->
                <div class="pick-buttons">
                  <button class="pick-btn draw-btn" 
                          [class.selected]="match.pick === 'DRAW'" 
                          (click)="selectPick(match, 'DRAW')">
                    X
                  </button>
                </div>

                <!-- Away Team -->
                <div class="team away" 
                     [class.selected]="match.pick === 'AWAY_WIN'"
                     (click)="selectPick(match, 'AWAY_WIN')">
                  <img *ngIf="match.awayIconUrl" 
                       [src]="match.awayIconUrl" 
                       [alt]="match.awayTeam" 
                       class="team-icon" />
                  <span class="team-name">{{ match.awayTeam }}</span>
                </div>
              </div>

              <!-- Tiebreaker Controls at Bottom -->
              <div *ngIf="match.isTiebreak" class="tiebreak-controls">
                <input type="number" 
                       min="0" 
                       [(ngModel)]="match.scoreHome" 
                       class="score-input" 
                       placeholder="0" />
                <span class="vs">-</span>
                <input type="number" 
                       min="0" 
                       [(ngModel)]="match.scoreAway" 
                       class="score-input" 
                       placeholder="0" />
              </div>
            </article>
          </section>
        </main>

        <!-- Session Participation Modal -->
        <app-session-participation-modal
          [isVisible]="showParticipationModal"
          [gameweekId]="gameweekId"
          [currentCompetition]="selectedCompetition"
          [predictions]="preparedPredictions"
          [userBalance]="userBalance"
          (participationSubmitted)="onParticipationSubmitted($event)"
          (modalClosed)="onModalClosed()"
        ></app-session-participation-modal>

        <!-- Footer -->
        <footer class="flex justify-between items-center mt-5 text-white/30 text-sm">
          <div class="submit-btn-container">
            <button (click)="submitPredictions()" class="action-btn submit-btn">
              Confirm
            </button>
            <button (click)="cancelPredictions()" class="action-btn cancel-btn">
              Cancel
            </button>
            <button (click)="resetPredictions()" class="action-btn reset-btn">
              Reset
            </button>
          </div>
        </footer>

      </div>
    </div>
  </div>
</div>
