<h3 class="subtitle">Liste des gameweeks</h3>

<!-- Modal backdrop -->
<div class="modal-backdrop" *ngIf="selectedGameweekForMatches" (click)="closeMatchesModal()"></div>

<!-- Modal content -->
<div class="modal" *ngIf="selectedGameweekForMatches" role="dialog" aria-modal="true">
  <app-show-gameweek-matches
    [gameweek]="selectedGameweekForMatches"
    [matches]="matchesForSelectedGameweek"
    (close)="closeMatchesModal()">
  </app-show-gameweek-matches>
</div>

<!-- Filters -->
<div class="filters" style="margin-bottom: 1rem; display: flex; gap: 1rem; align-items: center;">
  <label>
    Statut :
    <select [(ngModel)]="statusFilter">
      <option value="">Tous</option>
      <option *ngFor="let status of statuses" [value]="status.value">{{ status.label }}</option>
    </select>
  </label>

  <label>
    Comp√©tition :
    <select [(ngModel)]="competitionFilter">
      <option value="">Toutes</option>
      <option *ngFor="let comp of competitions" [value]="comp.value">{{ comp.label }}</option>
    </select>
  </label>

  <button type="button" (click)="applyFilters()" class="btn-primary">Filtrer</button>
  <button type="button" (click)="resetFilters()" class="btn-secondary">R√©initialiser</button>
</div>

<!-- Table + Actions -->
<div class="gameweek-table-container">
  <div style="display: flex; justify-content: flex-end; margin-bottom: 1rem; gap: 1rem;">
    <button class="btn-secondary" (click)="deleteSelectedGameweeks()" [disabled]="selectedGameweekIds.size === 0">
      Supprimer s√©lectionn√©s
    </button>
    <button class="btn-add" [routerLink]="['/admin/AddGameweek']" title="Ajouter un gameweek">+</button>
  </div>

  <table class="match-table">
    <thead>
      <tr>
        <th>
          <input
            type="checkbox"
            [checked]="allSelected()"
            (change)="toggleSelectAll($event)"
            aria-label="Tout s√©lectionner" />
        </th>
        <th>Semaine</th>
        <th>Comp√©tition</th>
        <th>Statut</th>
        <th>Date de d√©but</th>
        <th>Date de fin</th>
        <th>Time Left</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let gameweek of getPagedData(); trackBy: trackByGameweek"
          [ngClass]="getRowClass(gameweek.status)">
        <td>
          <input
            type="checkbox"
            [checked]="selectedGameweekIds.has(gameweek.id!)"
            (change)="onSelectionChange(gameweek, $event)"
            aria-label="S√©lectionner" />
        </td>
        <td>{{ gameweek.weekNumber }}</td>
        <td>{{ formatCompetition(gameweek.competition) }}</td>
        <td>
          <span [class]="getStatusClass(gameweek.status)">
            {{ gameweek.status }}
          </span>
        </td>
        <td>{{ gameweek.startDate | date: 'dd/MM/yyyy HH:mm' }}</td>
        <td>{{ gameweek.endDate | date: 'dd/MM/yyyy HH:mm' }}</td>
        <td class="deadline-timer" *ngIf="gameweek.joinDeadline">
          {{ getTimeLeft(gameweek.joinDeadline) }}
        </td>
        <td class="actions">
          <button
            [routerLink]="['/admin/gameweek/editGameweek', gameweek.id]"
            title="Modifier"
            class="btn-icon blue">
            ‚úèÔ∏è
          </button>
          <button
            (click)="deleteGameweek(gameweek.id!)"
            title="Supprimer"
            class="btn-icon red">
            üóëÔ∏è
          </button>
          <button
            (click)="showMatches(gameweek)"
            title="Voir les matchs"
            class="btn-icon green">
            ‚öΩÔ∏è
          </button>
          <!-- <button
            (click)="openMatchSelector(gameweek)"
            title="Ajouter des matchs"
            class="btn-icon purple">
            ‚ûï
          </button> -->
        </td>
      </tr>

      <!-- No result row -->
      <tr *ngIf="dataSource.filteredData.length === 0">
        <td colspan="8" class="text-center text-muted py-4">
          Aucune gameweek trouv√©e
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Paginator placed outside tbody -->
<mat-paginator
  [length]="dataSource.filteredData.length"
  [pageSize]="10"
  [pageSizeOptions]="[10, 19, 38, 300]"
  showFirstLastButtons>
</mat-paginator>
</div>