<div class="admin-dashboard">
  <h2>⚙️ Admin Dashboard - Funds Management</h2>

  <!-- Search and Refresh -->
  <div class="search-container">
    <div class="search-input-container">
      <input type="text" 
             placeholder="Rechercher par nom, email, ID ou solde..." 
             [(ngModel)]="searchQuery" 
             (input)="searchUsers()"
             (keyup)="searchUsers()" />
      <button class="btn-refresh" 
              (click)="refreshUsers()" 
              [disabled]="refreshing"
              title="Rafraîchir la liste des utilisateurs">
        <span *ngIf="!refreshing" class="refresh-icon">🔄</span>
        <span *ngIf="refreshing" class="refresh-icon spinning">⏳</span>
      </button>
    </div>
    <div *ngIf="isSearchActive()" class="search-results-info">
      {{ getSearchResultsCount() }} résultat(s) trouvé(s)
    </div>
  </div>

  <!-- Users Table -->
  <div class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom d'utilisateur</th>
          <th>Email</th>
          <th>Solde</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers" 
            [class.row-banned]="!user.active"
            [class.row-temp-banned]="user.active && isTemporarilyBanned(user)"
            [class.row-active]="user.active && !isTemporarilyBanned(user)">
          <td>{{ user.id }}</td>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td><strong>{{ user.balance | currency:'EUR':'symbol':'1.2-2' }}</strong></td>
          <td>
            <span *ngIf="!user.active" class="inactive">Banni définitivement</span>
            <span *ngIf="user.active && isTemporarilyBanned(user)" class="temp-banned">
              Banni jusqu'au {{ user.bannedUntil | date:'dd/MM/yyyy' }}
            </span>
            <span *ngIf="user.active && !isTemporarilyBanned(user)" class="active">
              Actif
            </span>
          </td>
          <td class="actions">
            <input type="number" 
                   [ngModel]="getUserAmount(user.id)" 
                   (ngModelChange)="updateUserAmount(user.id, $event)"
                   placeholder="Montant" 
                   class="amount-input"
                   min="0"
                   step="0.01" />
            <button class="btn-action btn-credit" 
                    (click)="creditBalance(user.id)"
                    title="Créditer le solde">
              💰 Créditer
            </button>
            <button class="btn-action btn-debit" 
                    (click)="debitBalance(user.id)"
                    title="Débiter le solde">
              💸 Débiter
            </button>
            <button class="btn-action btn-temp-ban" 
                    (click)="banUser(user.id, 1)"
                    title="Bannir temporairement 1 jours">
              ⏳ Ban 1j
            </button>
            <button class="btn-action btn-temp-ban" 
                    (click)="banUser(user.id, 3)"
                    title="Bannir temporairement 3 jours">
              ⏳ Ban 3j
            </button>
            <button class="btn-action btn-temp-ban" 
                    (click)="banUser(user.id, 7)"
                    title="Bannir temporairement 7 jours">
              ⏳ Ban 7j
            </button>
            <button class="btn-action btn-perm-ban" 
                    (click)="banUser(user.id)"
                    title="Bannir définitivement">
              🚫 Ban définitif
            </button>
            <button class="btn-action btn-unban" 
                    (click)="unbanUser(user.id)"
                    title="Débannir l'utilisateur">
              ✅ Débannir
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Message -->
  <div *ngIf="message" 
       class="message-container"
       [class.success]="message.includes('Credited') || message.includes('Debited') || message.includes('unbanned')"
       [class.error]="message.includes('Error') || message.includes('❌')"
       [class.warning]="message.includes('⚠️')">
    <p><strong>Réponse:</strong> {{ message }}</p>
  </div>
</div>
