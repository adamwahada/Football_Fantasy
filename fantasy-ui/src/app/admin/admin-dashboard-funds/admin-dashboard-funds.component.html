<div class="admin-dashboard">
  <h2>âš™ï¸ Admin Dashboard - Funds Management</h2>

  <!-- Search, Filter and Refresh -->
  <div class="search-container" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">
    
    <!-- Search Input -->
    <div class="search-input-container" style="flex: 1; display: flex; align-items: center; gap: 5px;">
      <input type="text" 
            placeholder="Rechercher par nom, email, ID ou solde..." 
            [(ngModel)]="searchQuery" 
            (input)="searchUsers()"
            (keyup)="searchUsers()" 
            style="flex: 1; padding: 5px;" />
      <button class="btn-refresh" 
              (click)="refreshUsers()" 
              [disabled]="refreshing"
              title="RafraÃ®chir la liste des utilisateurs">
        <span *ngIf="!refreshing" class="refresh-icon">ğŸ”„</span>
        <span *ngIf="refreshing" class="refresh-icon spinning">â³</span>
      </button>
    </div>

    <!-- Status Filter -->
    <div class="filter-container" style="display: flex; align-items: center;">
      <label class="filter-label">
        <span class="filter-text">Filtrer par statut :</span>
        <select [(ngModel)]="selectedStatus" 
                (change)="onStatusFilterChange()"
                class="status-filter"
                style="margin-left: 5px; padding: 5px;">
                <option value="all">Tous les utilisateurs</option>
                <option value="active">Actif</option>
                <option value="temp-banned">Ban temporaire</option>
                <option value="permanently-banned">Ban dÃ©finitif</option>
        </select>
      </label>
    </div>

  </div>

<!-- Active filters -->
<div class="active-filters" *ngIf="searchQuery || selectedStatus !== 'all'" style="margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 5px;">
  <span *ngIf="searchQuery && searchQuery.trim() !== ''" class="filter-chip">
    ğŸ” Recherche: "{{ searchQuery }}"
    <button type="button" class="remove-filter" (click)="clearSearch()">âœ–</button>
  </span>

  <span *ngIf="selectedStatus && selectedStatus !== 'all'" class="filter-chip">
    âš¡ Statut: {{ getStatusLabel(selectedStatus) }}
    <button type="button" class="remove-filter" (click)="clearStatus()">âœ–</button>
  </span>
</div>

<!-- Search results info -->
<div *ngIf="isSearchActive() || selectedStatus !== 'all'" class="search-results-info" style="margin-bottom: 10px; font-style: italic;">
  {{ getSearchResultsCount() }} rÃ©sultat(s) trouvÃ©(s)
</div>


  <!-- Users Table -->
  <div class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom d'utilisateur</th>
          <th>Email</th>
          <th>Solde</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of pagedUsers" 
            [class.row-banned]="!user.active"
            [class.row-temp-banned]="user.active && isTemporarilyBanned(user)"
            [class.row-active]="user.active && !isTemporarilyBanned(user)">
          <td>{{ user.id }}</td>
          <td style="font-size: 20px; font-weight: bold;">{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td><strong>{{ user.balance | currency:'EUR':'symbol':'1.2-2' }}</strong></td>
          <td>
            <span *ngIf="!user.active" class="inactive">Banni dÃ©finitivement</span>
            <span *ngIf="user.active && isTemporarilyBanned(user)" class="temp-banned">
              Banni jusqu'au {{ user.bannedUntil | date:'dd/MM/yyyy' }}
            </span>
            <span *ngIf="user.active && !isTemporarilyBanned(user)" class="active">
              Actif
            </span>
          </td>
          <td class="actions">
            <input type="number" 
                   [ngModel]="getUserAmount(user.id)" 
                   (ngModelChange)="updateUserAmount(user.id, $event)"
                   placeholder="Montant" 
                   class="amount-input"
                   min="0"
                   step="0.01" />
            <button class="btn-action btn-credit" 
                    (click)="creditBalance(user.id)"
                    title="CrÃ©diter le solde">
              ğŸ’° CrÃ©diter
            </button>
            <button class="btn-action btn-debit" 
                    (click)="debitBalance(user.id)"
                    title="DÃ©biter le solde">
              ğŸ’¸ DÃ©biter
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Paginator -->
  <mat-paginator
    [length]="filteredUsers.length"
    [pageSize]="pageSize"
    [pageSizeOptions]="[25, 50, 100]"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>

  <!-- Message -->
  <div *ngIf="message" 
       class="message-container"
       [class.success]="message.includes('Credited') || message.includes('Debited') || message.includes('unbanned')"
       [class.error]="message.includes('Error') || message.includes('âŒ')"
       [class.warning]="message.includes('âš ï¸')">
    <p><strong>RÃ©ponse:</strong> {{ message }}</p>
  </div>
</div>
