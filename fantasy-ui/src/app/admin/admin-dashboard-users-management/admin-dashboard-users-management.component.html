<div class="admin-dashboard">
  <h2>👥 Admin Dashboard - Gestion des Utilisateurs</h2>

  <!-- Search and Filter -->
  <div class="search-container" style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;">

    <!-- Search Input -->
    <div class="search-input-container" style="flex: 1; display: flex; align-items: center; gap: 5px;">
      <input type="text" 
             placeholder="Rechercher par nom, email, ID ou solde..." 
             [(ngModel)]="searchQuery" 
             (input)="searchUsers()"
             (keyup)="searchUsers()" 
             style="flex: 1; padding: 5px;" />
      <button class="btn-refresh" 
              (click)="refreshUsers()" 
              [disabled]="refreshing"
              title="Rafraîchir la liste des utilisateurs">
        <span *ngIf="!refreshing" class="refresh-icon">🔄</span>
        <span *ngIf="refreshing" class="refresh-icon spinning">⏳</span>
      </button>
    </div>

    <!-- Status Filter -->
    <div class="filter-container" style="display: flex; align-items: center;">
      <label class="filter-label">
        <span class="filter-text">Filtrer par statut :</span>
        <select [(ngModel)]="selectedStatus" 
                (change)="onStatusFilterChange()"
                class="status-filter"
                style="margin-left: 5px; padding: 5px;">
          <option value="all">Tous les utilisateurs</option>
          <option value="active">Actifs uniquement</option>
          <option value="temp-banned">Bannis temporairement</option>
          <option value="permanently-banned">Bannis définitivement</option>
        </select>
      </label>
    </div>

  </div>

  <!-- Active filters -->
  <div class="active-filters" *ngIf="searchQuery || selectedStatus !== 'all'" style="margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 5px;">
    <span *ngIf="searchQuery && searchQuery.trim() !== ''" class="filter-chip">
      🔍 Recherche: "{{ searchQuery }}"
      <button type="button" class="remove-filter" (click)="clearSearch()">✖</button>
    </span>

    <span *ngIf="selectedStatus && selectedStatus !== 'all'" class="filter-chip">
      ⚡ Statut: {{ getStatusLabel(selectedStatus) }}
      <button type="button" class="remove-filter" (click)="clearStatus()">✖</button>
    </span>
  </div>

  <!-- Search results info -->
  <div *ngIf="isSearchActive() || selectedStatus !== 'all'" class="search-results-info" style="margin-bottom: 10px; font-style: italic;">
    {{ getSearchResultsCount() }} résultat(s) trouvé(s)
  </div>

  <!-- Users Table -->
  <div class="users-table-container">
    <table class="users-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nom d'utilisateur</th>
          <th>Email</th>
          <th>Solde</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers" 
            [class.row-banned]="!user.active"
            [class.row-temp-banned]="user.active && isTemporarilyBanned(user)"
            [class.row-active]="user.active && !isTemporarilyBanned(user)">
          <td>{{ user.id }}</td>
          <td style="font-size: 20px; font-weight: bold;">{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td><strong>{{ user.balance | currency:'EUR':'symbol':'1.2-2' }}</strong></td>
          <td>
            <span *ngIf="!user.active" class="inactive">Banni définitivement</span>
            <span *ngIf="user.active && isTemporarilyBanned(user)" class="temp-banned">
              Banni jusqu'au {{ user.bannedUntil | date:'dd/MM/yyyy' }}
            </span>
            <span *ngIf="user.active && !isTemporarilyBanned(user)" class="active">
              Actif
            </span>
          </td>
          <td class="actions">
            <button class="btn-action btn-temp-ban" (click)="banUser(user.id, 1)" title="Bannir temporairement 1 jour">⏳ Ban 1j</button>
            <button class="btn-action btn-temp-ban" (click)="banUser(user.id, 3)" title="Bannir temporairement 3 jours">⏳ Ban 3j</button>
            <button class="btn-action btn-temp-ban" (click)="banUser(user.id, 7)" title="Bannir temporairement 7 jours">⏳ Ban 7j</button>
            <button class="btn-action btn-perm-ban" (click)="banUser(user.id)" title="Bannir définitivement">🚫 Ban définitif</button>
            <button class="btn-action btn-unban" (click)="unbanUser(user.id)" title="Débannir l'utilisateur">✅ Débannir</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Message -->
  <div *ngIf="message" class="message-container"
       [class.success]="message.includes('débanni')"
       [class.error]="message.includes('Erreur') || message.includes('❌')"
       [class.warning]="message.includes('⚠️')">
    <p><strong>Réponse:</strong> {{ message }}</p>
  </div>
</div>
