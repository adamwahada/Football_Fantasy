<div class="support-page-container">
  <!-- Header -->
  <div class="support-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-button" (click)="onBackToChat()">
          <span class="back-icon">‚Üê</span>
          Retour au chat
        </button>
      </div>
      <div class="header-center">
        <h1>Support Client</h1>
        <p>Nous sommes l√† pour vous aider</p>
      </div>
      <div class="header-right">
        <button 
          *ngIf="!showTicketForm" 
          class="new-ticket-btn"
          (click)="onCreateNewTicket()"
        >
          <span class="plus-icon">+</span>
          Nouveau ticket
        </button>
      </div>
    </div>
  </div>

  <!-- Contenu principal -->
  <div class="support-content">
    
    <!-- Formulaire de cr√©ation de ticket -->
    <div *ngIf="showTicketForm" class="form-section">
      <div class="support-ticket-form-container">
        <div class="form-header">
          <div class="header-icon">üÜò</div>
          <h2>Cr√©er un ticket de support</h2>
          <p>D√©crivez votre probl√®me et nous vous aiderons rapidement</p>
        </div>

        <form [formGroup]="supportForm" (ngSubmit)="onSubmit()" class="support-form">
          
          <!-- S√©lection du type de support -->
          <div class="form-section">
            <label class="section-label">Type de probl√®me *</label>
            <div class="type-selector">
              <div 
                *ngFor="let type of supportTypes" 
                class="type-option"
                [class.selected]="selectedType === type.value"
                (click)="onTypeSelect(type.value)"
              >
                <div class="type-icon">{{ getSupportTypeIcon(type.value) }}</div>
                <div class="type-info">
                  <div class="type-name">{{ type.displayName }}</div>
                  <div class="type-description">
                    {{ getTypeDescription(type.value) }}
                  </div>
                </div>
                <div class="type-check" *ngIf="selectedType === type.value">‚úì</div>
              </div>
            </div>
            <div class="error-message" *ngIf="typeError">{{ typeError }}</div>
          </div>

          <!-- Sujet du ticket -->
          <div class="form-section">
            <label class="section-label" for="subject">Sujet *</label>
            <input 
              id="subject"
              type="text" 
              formControlName="subject"
              placeholder="Ex: Probl√®me de paiement avec ma carte"
              class="form-input"
              [class.error]="supportForm.get('subject')?.invalid && supportForm.get('subject')?.touched"
            >
            <div class="error-message" *ngIf="subjectError">{{ subjectError }}</div>
            <div class="char-counter">
              {{ supportForm.get('subject')?.value?.length || 0 }}/100
            </div>
          </div>

          <!-- Description d√©taill√©e -->
          <div class="form-section">
            <label class="section-label" for="description">Description d√©taill√©e *</label>
            <textarea 
              id="description"
              formControlName="description"
              placeholder="D√©crivez votre probl√®me en d√©tail. Plus vous donnez d'informations, plus nous pourrons vous aider rapidement..."
              class="form-textarea"
              rows="6"
              [class.error]="supportForm.get('description')?.invalid && supportForm.get('description')?.touched"
            ></textarea>
            <div class="error-message" *ngIf="descriptionError">{{ descriptionError }}</div>
            <div class="char-counter">
              {{ supportForm.get('description')?.value?.length || 0 }}/1000
            </div>
          </div>

          <!-- Conseils d'aide -->
          <div class="help-tips" *ngIf="selectedType">
            <div class="tips-header">
              <span class="tips-icon">üí°</span>
              <span>Conseils pour un ticket efficace</span>
            </div>
            <ul class="tips-list">
              <li *ngIf="selectedType === 'PAYMENT'">
                Incluez les d√©tails de votre transaction (montant, date, m√©thode de paiement)
              </li>
              <li *ngIf="selectedType === 'TECHNICAL'">
                D√©crivez les √©tapes qui m√®nent au probl√®me et votre environnement (navigateur, OS)
              </li>
              <li *ngIf="selectedType === 'ACCOUNT'">
                Pr√©cisez si le probl√®me concerne la connexion, les donn√©es personnelles ou les param√®tres
              </li>
              <li *ngIf="selectedType === 'GENERAL'">
                Soyez aussi pr√©cis que possible pour que nous puissions vous orienter vers la bonne √©quipe
              </li>
            </ul>
          </div>

          <!-- Boutons d'action -->
          <div class="form-actions">
            <button 
              type="button" 
              class="btn-secondary"
              (click)="onBackToChat()"
              [disabled]="isLoading"
            >
              Annuler
            </button>
            <button 
              type="submit" 
              class="btn-primary"
              [disabled]="supportForm.invalid || isLoading"
            >
              <span *ngIf="!isLoading">Cr√©er le ticket</span>
              <span *ngIf="isLoading" class="loading-spinner">
                <div class="spinner"></div>
                Cr√©ation en cours...
              </span>
            </button>
          </div>

        </form>
      </div>
    </div>

    <!-- Liste des tickets existants -->
    <div *ngIf="!showTicketForm" class="tickets-section">
      
      <!-- Header de la section tickets -->
      <div class="tickets-header">
        <h2>Mes tickets de support</h2>
        <p *ngIf="userTickets.length === 0">
          Vous n'avez pas encore cr√©√© de ticket de support.
        </p>
      </div>

      <!-- Loading state -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p>Chargement de vos tickets...</p>
        </div>
      </div>

      <!-- Liste des tickets -->
      <div *ngIf="!isLoading && userTickets.length > 0" class="tickets-list">
        <div 
          *ngFor="let ticket of userTickets" 
          class="ticket-card"
          (click)="onViewTicket(ticket)"
        >
          <div class="ticket-header">
            <div class="ticket-type">
              <span class="type-icon">{{ getSupportTypeIcon(ticket.supportType || '') }}</span>
              <span class="type-name">{{ getSupportTypeDisplayName(ticket.supportType || '') }}</span>
            </div>
            <div class="ticket-status">
              <span 
                class="status-badge"
                [style.background-color]="getSupportStatusColor(ticket.supportStatus || '')"
              >
                {{ getSupportStatusDisplayName(ticket.supportStatus || '') }}
              </span>
            </div>
          </div>

          <div class="ticket-content">
            <h3 class="ticket-title">{{ ticket.name }}</h3>
            <p class="ticket-description">{{ ticket.description }}</p>
          </div>

          <div class="ticket-footer">
            <div class="ticket-meta">
              <span class="ticket-id" *ngIf="ticket.supportTicketId">
                #{{ ticket.supportTicketId }}
              </span>
              <span class="ticket-date">
                {{ formatDate(ticket.lastActivity) }}
              </span>
            </div>
            <div class="ticket-actions">
              <span class="unread-count" *ngIf="ticket.unreadCount > 0">
                {{ ticket.unreadCount }} nouveau(x)
              </span>
              <span class="view-ticket">Voir le chat ‚Üí</span>
            </div>
          </div>
        </div>
      </div>

      <!-- √âtat vide -->
      <div *ngIf="!isLoading && userTickets.length === 0" class="empty-state">
        <div class="empty-icon">üìã</div>
        <h3>Aucun ticket de support</h3>
        <p>Vous n'avez pas encore cr√©√© de ticket de support.</p>
        <button class="create-first-ticket-btn" (click)="onCreateNewTicket()">
          Cr√©er mon premier ticket
        </button>
      </div>

    </div>

  </div>

  <!-- Footer avec informations -->
  <div class="support-footer">
    <div class="footer-content">
      <div class="footer-info">
        <h4>Besoin d'aide rapide ?</h4>
        <p>Notre √©quipe de support est disponible pour vous aider avec tous vos probl√®mes.</p>
      </div>
      <div class="footer-stats">
        <div class="stat-item">
          <span class="stat-number">24/7</span>
          <span class="stat-label">Support disponible</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">< 2h</span>
          <span class="stat-label">Temps de r√©ponse</span>
        </div>
      </div>
    </div>
  </div>

</div>
